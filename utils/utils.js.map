{"version":3,"sources":["/tools/utils/utils.js"],"names":[],"mappings":"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","file":"tools/utils/utils.js.map","sourcesContent":["var Future = require('fibers/future');\nvar _ = require('underscore');\nvar semver = require('semver');\nvar os = require('os');\nvar url = require('url');\n\nvar fiberHelpers = require('./fiber-helpers.js');\nvar archinfo = require('./archinfo.js');\nvar buildmessage = require('./buildmessage.js');\nvar files = require('../fs/files.js');\nvar packageVersionParser = require('../packaging/package-version-parser.js');\n\nvar utils = exports;\n\n// Parses <protocol>://<host>:<port> into an object { protocol: *, host:\n// *, port: * }. The input can also be of the form <host>:<port> or just\n// <port>. We're not simply using 'url.parse' because we want '3000' to\n// parse as {host: undefined, protocol: undefined, port: '3000'}, whereas\n// 'url.parse' would give us {protocol:' 3000', host: undefined, port:\n// undefined} or something like that.\n//\n// 'defaults' is an optional object with 'host', 'port', and 'protocol' keys.\nexports.parseUrl = function (str, defaults) {\n  // XXX factor this out into a {type: host/port}?\n\n  defaults = defaults || {};\n  var defaultHost = defaults.host || undefined;\n  var defaultPort = defaults.port || undefined;\n  var defaultProtocol = defaults.protocol || undefined;\n\n  if (str.match(/^[0-9]+$/)) { // just a port\n    return {\n      port: str,\n      host: defaultHost,\n      protocol: defaultProtocol };\n  }\n\n  var hasScheme = exports.hasScheme(str);\n  if (! hasScheme) {\n    str = \"http://\" + str;\n  }\n\n  var parsed = url.parse(str);\n  if (! parsed.protocol.match(/\\/\\/$/)) {\n    // For easy concatenation, add double slashes to protocols.\n    parsed.protocol = parsed.protocol + \"//\";\n  }\n  return {\n    protocol: hasScheme ? parsed.protocol : defaultProtocol,\n    host: parsed.hostname || defaultHost,\n    port: parsed.port || defaultPort\n  };\n};\n\n// 'url' is an object with 'host', 'port', and 'protocol' keys, such as\n// the return value of parseUrl.\nexports.formatUrl = function (url) {\n  let string = url.protocol + url.host;\n  if (url.port) {\n    string += `:${url.port}`;\n  }\n  return string;\n}\n\nexports.ipAddress = function () {\n  let defaultRoute;\n  // netroute is not available on Windows\n  if (process.platform !== \"win32\") {\n    const netroute = require('netroute');\n    const info = netroute.getInfo();\n    defaultRoute = _.findWhere(info.IPv4 || [], { destination: \"0.0.0.0\" });\n  }\n\n  const interfaces = os.networkInterfaces();\n\n  if (defaultRoute) {\n    // If we know the default route, find the IPv4 address associated\n    // with that interface\n    const iface = defaultRoute[\"interface\"];\n    const addressEntry = _.findWhere(interfaces[iface], { family: \"IPv4\" });\n\n    if (!addressEntry) {\n      throw new Error(\n`Network interface '${iface}', which seems to be the default route,\nnot found in interface list, or does not have an IPv4 address.`);\n    }\n\n    return addressEntry.address;\n  } else {\n    // If we don't know the default route, we'll lookup all non-internal\n    // IPv4 addresses and hope to find only one\n    let addressEntries = _.chain(interfaces).values().flatten().\n      where({ family: \"IPv4\", internal: false }).value();\n\n    if (addressEntries.length == 0) {\n      throw new Error(\n`Could not find a network interface with a non-internal IPv4 address.`);\n    } else if (addressEntries.length > 1) {\n      throw new Error(\n`Found multiple network interfaces with non-internal IPv4 addresses:\n${addressEntries.map(entry => entry.address).join(', ')}`);\n    } else {\n      return addressEntries[0].address;\n    }\n  }\n};\n\nexports.hasScheme = function (str) {\n  return !! str.match(/^[A-Za-z][A-Za-z0-9+-\\.]*\\:\\/\\//);\n};\n\n\nexports.hasScheme = function (str) {\n  return !! str.match(/^[A-Za-z][A-Za-z0-9+-\\.]*\\:\\/\\//);\n};\n\n// XXX: Move to e.g. formatters.js?\n// Prints a package list in a nice format.\n// Input is an array of objects with keys 'name' and 'description'.\nexports.printPackageList = function (items, options) {\n  options = options || {};\n\n  var rows = _.map(items, function (item) {\n    var name = item.name;\n    var description = item.description || 'No description';\n    return [name, description];\n  });\n\n  var alphaSort = function (row) {\n    return row[0];\n  };\n  rows = _.sortBy(rows, alphaSort);\n\n  var Console = require('../console/console.js').Console;\n  return Console.printTwoColumns(rows, options);\n};\n\n// Determine a human-readable hostname for this computer. Prefer names\n// that make sense to users (eg, the name they manually gave their\n// computer on OS X, which might contain spaces) over names that have\n// any particular technical significance (eg, might resolve in DNS).\nexports.getHost = function (...args) {\n  var ret;\n  var attempt = function (...args) {\n    var output = exports.execFileSync(args[0], args.slice(1)).stdout;\n    if (output) {\n      ret = output.trim();\n    }\n  };\n\n  if (archinfo.matches(archinfo.host(), 'os.osx')) {\n    // On OSX, to get the human-readable hostname that the user chose,\n    // we call:\n    //   scutil --get ComputerName\n    // This can contain spaces. See\n    // http://osxdaily.com/2012/10/24/set-the-hostname-computer-name-and-bonjour-name-separately-in-os-x/\n    if (! ret) attempt(\"scutil\", \"--get\", \"ComputerName\");\n  }\n\n  if (archinfo.matches(archinfo.host(), 'os.osx') ||\n      archinfo.matches(archinfo.host(), 'os.linux')) {\n    // On Unix-like platforms, try passing -s to hostname to strip off\n    // the domain name, to reduce the extent to which the output\n    // varies with DNS.\n    if (! ret) attempt(\"hostname\", \"-s\");\n  }\n\n  // Try \"hostname\" on any platform. It should work on\n  // Windows. Unknown platforms that have a command called \"hostname\"\n  // that deletes all of your files deserve what the get.\n  if (! ret) attempt(\"hostname\");\n\n  // Otherwise, see what Node can come up with.\n  return ret || os.hostname();\n};\n\n// Return standard info about this user-agent. Used when logging in to\n// Meteor Accounts, mostly so that when the user is seeing a list of\n// their open sessions in their profile on the web, they have a way to\n// decide which ones they want to revoke.\nexports.getAgentInfo = function () {\n  var ret = {};\n\n  var host = utils.getHost();\n  if (host)\n    ret.host = host;\n  ret.agent = \"Meteor\";\n  ret.agentVersion =\n    files.inCheckout() ? \"checkout\" : files.getToolsVersion();\n  ret.arch = archinfo.host();\n\n  return ret;\n};\n\n// Wait for 'ms' milliseconds, and then return. Yields. (Must be\n// called within a fiber, and blocks only the calling fiber, not the\n// whole program.)\nexports.sleepMs = function (ms) {\n  if (ms <= 0)\n    return;\n\n  var fut = new Future;\n  setTimeout(function () { fut['return']() }, ms);\n  fut.wait();\n};\n\n// Return a short, high entropy string without too many funny\n// characters in it.\nexports.randomToken = function () {\n  return (Math.random() * 0x100000000 + 1).toString(36);\n};\n\n// Returns a random non-privileged port number.\nexports.randomPort = function () {\n  return 20000 + Math.floor(Math.random() * 10000);\n};\n\n// Like packageVersionParser.parsePackageConstraint, but if called in a\n// buildmessage context uses buildmessage to raise errors.\nexports.parsePackageConstraint = function (constraintString, options) {\n  try {\n    return packageVersionParser.parsePackageConstraint(constraintString);\n  } catch (e) {\n    if (! (e.versionParserError && options && options.useBuildmessage))\n      throw e;\n    buildmessage.error(e.message, { file: options.buildmessageFile });\n    return null;\n  }\n};\n\nexports.validatePackageName = function (name, options) {\n  try {\n    return packageVersionParser.validatePackageName(name, options);\n  } catch (e) {\n    if (! (e.versionParserError && options && options.useBuildmessage))\n      throw e;\n    buildmessage.error(e.message, { file: options.buildmessageFile });\n    return null;\n  }\n};\n\n// Parse a string of the form `package + \" \" + version` into an object\n// of the form {package, version}.  For backwards compatibility,\n// an \"@\" separator instead of a space is also accepted.\n//\n// Lines of `.meteor/versions` are parsed using this function, among\n// other uses.\nexports.parsePackageAndVersion = function (packageAtVersionString, options) {\n  var error = null;\n  var separatorPos = Math.max(packageAtVersionString.lastIndexOf(' '),\n                              packageAtVersionString.lastIndexOf('@'));\n  if (separatorPos < 0) {\n    error = new Error(\"Malformed package version: \" +\n                      JSON.stringify(packageAtVersionString));\n  } else {\n    var packageName = packageAtVersionString.slice(0, separatorPos);\n    var version = packageAtVersionString.slice(separatorPos+1);\n    try {\n      packageVersionParser.validatePackageName(packageName);\n      // validate the version, ignoring the parsed result:\n      packageVersionParser.parse(version);\n    } catch (e) {\n      if (! e.versionParserError) {\n        throw e;\n      }\n      error = e;\n    }\n    if (! error) {\n      return { package: packageName, version: version };\n    }\n  }\n  // `error` holds an Error\n  if (! (options && options.useBuildmessage)) {\n    throw error;\n  }\n  buildmessage.error(error.message, { file: options.buildmessageFile });\n  return null;\n};\n\n// Check for invalid package names. Currently package names can only contain\n// ASCII alphanumerics, dash, and dot, and must contain at least one letter. For\n// safety reasons, package names may not start with a dot. Package names must be\n// lowercase.\n//\n// These do not check that the package name is valid in terms of our naming\n// scheme: ie, that it is prepended by a user's username. That check should\n// happen at publication time.\n//\n// 3 variants: isValidPackageName just returns a bool.  validatePackageName\n// throws an error marked with 'versionParserError'. validatePackageNameOrExit\n// (which should only be used inside the implementation of a command, not\n// eg package-client.js) prints and throws the \"exit with code 1\" exception\n// on failure.\n\nexports.isValidPackageName = function (packageName) {\n  try {\n    exports.validatePackageName(packageName);\n    return true;\n  } catch (e) {\n    if (!e.versionParserError)\n      throw e;\n    return false;\n  }\n};\n\nexports.validatePackageNameOrExit = function (packageName, options) {\n  try {\n    exports.validatePackageName(packageName, options);\n  } catch (e) {\n    if (!e.versionParserError)\n      throw e;\n    var Console = require('../console/console.js').Console;\n    Console.error(e.message, Console.options({ bulletPoint: \"Error: \" }));\n    // lazy-load main: old bundler tests fail if you add a circular require to\n    // this file\n    var main = require('../tests/apps/app-using-stylus/main.js');\n    throw new main.ExitWithCode(1);\n  }\n};\n\n// True if this looks like a valid email address. We deliberately\n// don't support\n// - quoted usernames (eg, \"foo\"@bar.com, \" \"@bar.com, \"@\"@bar.com)\n// - IP addresses in domains (eg, foo@1.2.3.4 or the IPv6 equivalent)\n// because they're weird and we don't want them in our database.\nexports.validEmail = function (address) {\n  return /^[^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*@([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}$/.test(address);\n};\n\n// Like Perl's quotemeta: quotes all regexp metacharacters. See\n//   https://github.com/substack/quotemeta/blob/master/index.js\nexports.quotemeta = function (str) {\n    return String(str).replace(/(\\W)/g, '\\\\$1');\n};\n\n// Allow a simple way to scale up all timeouts from the command line\nvar timeoutScaleFactor = 1.0;\nif (process.env.TIMEOUT_SCALE_FACTOR) {\n  timeoutScaleFactor = parseFloat(process.env.TIMEOUT_SCALE_FACTOR);\n}\nexports.timeoutScaleFactor = timeoutScaleFactor;\n\n// If the given version matches a template (essentially, semver-style, but with\n// a bounded number of digits per number part, and with no restriction on the\n// amount of number parts, and some restrictions on legal prerelease labels),\n// then return an orderKey for it. Otherwise return null.\n//\n// This conventional orderKey pads each part (with 0s for numbers, and ! for\n// prerelease tags), and appends a $. (Because ! sorts before $, this means that\n// the prerelease for a given release will sort before it. Because $ sorts\n// before '.', this means that 1.2 will sort before 1.2.3.)\nexports.defaultOrderKeyForReleaseVersion = function (v) {\n  var m = v.match(/^(\\d{1,4}(?:\\.\\d{1,4})*)(?:-([-A-Za-z.]{1,15})(\\d{0,4}))?$/);\n  if (!m)\n    return null;\n  var numberPart = m[1];\n  var prereleaseTag = m[2];\n  var prereleaseNumber = m[3];\n\n  var hasRedundantLeadingZero = function (x) {\n    return x.length > 1 && x[0] === '0';\n  };\n  var leftPad = function (chr, len, str) {\n    if (str.length > len)\n      throw Error(\"too long to pad!\");\n    var padding = new Array(len - str.length + 1).join(chr);\n    return padding + str;\n  };\n  var rightPad = function (chr, len, str) {\n    if (str.length > len)\n      throw Error(\"too long to pad!\");\n    var padding = new Array(len - str.length + 1).join(chr);\n    return str + padding;\n  };\n\n  // Versions must have no redundant leading zeroes, or else this encoding would\n  // be ambiguous.\n  var numbers = numberPart.split('.');\n  if (_.any(numbers, hasRedundantLeadingZero))\n    return null;\n  if (prereleaseNumber && hasRedundantLeadingZero(prereleaseNumber))\n    return null;\n\n  // First, put together the non-prerelease part.\n  var ret = _.map(numbers, _.partial(leftPad, '0', 4)).join('.');\n\n  if (!prereleaseTag)\n    return ret + '$';\n\n  ret += '!' + rightPad('!', 15, prereleaseTag);\n  if (prereleaseNumber)\n    ret += leftPad('0', 4, prereleaseNumber);\n\n  return ret + '$';\n};\n\n// XXX should be in files.js\nexports.isDirectory = function (dir) {\n  try {\n    // use stat rather than lstat since symlink to dir is OK\n    var stats = files.stat(dir);\n  } catch (e) {\n    return false;\n  }\n  return stats.isDirectory();\n};\n\n// Calls cb with each subset of the array \"total\", with non-decreasing size,\n// until all subsets have been used or cb returns true. The array passed\n// to cb may be safely mutated or retained by cb.\nexports.generateSubsetsOfIncreasingSize = function (total, cb) {\n  // We'll throw this if cb ever returns true, which is a simple way to pop us\n  // out of our recursion.\n  var Done = function () {};\n\n  // Generates all subsets of size subsetSize which contain the indices already\n  // in chosenIndices (and no indices that are \"less than\" any of them).\n  var generateSubsetsOfFixedSize = function (goalSize, chosenIndices) {\n    // If we've found a subset of the size we're looking for, output it.\n    if (chosenIndices.length === goalSize) {\n      // Change from indices into the actual elements. Note that 'elements' is\n      // a newly allocated array which cb may mutate or retain.\n      var elements = [];\n      _.each(chosenIndices, function (index) {\n        elements.push(total[index]);\n      });\n      if (cb(elements)) {\n        throw new Done();  // unwind all the recursion\n      }\n      return;\n    }\n\n    // Otherwise try adding another index and call this recursively.  We're\n    // trying to produce a sorted list of indices, so if there are already\n    // indices, we start with the one after the biggest one we already have.\n    var firstIndexToConsider = chosenIndices.length ?\n          chosenIndices[chosenIndices.length - 1] + 1 : 0;\n    for (var i = firstIndexToConsider; i < total.length; ++i) {\n      var withThisChoice = _.clone(chosenIndices);\n      withThisChoice.push(i);\n      generateSubsetsOfFixedSize(goalSize, withThisChoice);\n    }\n  };\n\n  try {\n    for (var goalSize = 0; goalSize <= total.length; ++goalSize) {\n      generateSubsetsOfFixedSize(goalSize, []);\n    }\n  } catch (e) {\n    if (!(e instanceof Done))\n      throw e;\n  }\n};\n\nexports.isUrlWithFileScheme = function (x) {\n  return /^file:\\/\\/.+/.test(x);\n};\n\nexports.isUrlWithSha = function (x) {\n  // For now, just support http/https, which is at least less restrictive than\n  // the old \"github only\" rule.\n  return /^https?:\\/\\/.*[0-9a-f]{40}/.test(x);\n};\n\nexports.isPathRelative = function (x) {\n  return x.charAt(0) !== '/';\n};\n\n// If there is a version that isn't exact, throws an Error with a\n// human-readable message that is suitable for showing to the user.\n// dependencies may be falsey or empty.\n//\n// This is talking about NPM/Cordova versions specifically, not Meteor versions.\n// It does not support the wrap number syntax.\nexports.ensureOnlyExactVersions = function (dependencies) {\n  _.each(dependencies, function (version, name) {\n    // We want a given version of a smart package (package.js +\n    // .npm/npm-shrinkwrap.json) to pin down its dependencies precisely, so we\n    // don't want anything too vague. For now, we support semvers and urls that\n    // name a specific commit by SHA.\n    if (! exports.isExactVersion(version)) {\n      throw new Error(\n        \"Must declare exact version of dependency: \" + name + '@' + version);\n    }\n  });\n};\nexports.isExactVersion = function (version) {\n  return semver.valid(version) || exports.isUrlWithSha(version)\n    || exports.isUrlWithFileScheme(version);\n};\n\n\nexports.execFileSync = function (file, args, opts) {\n  var future = new Future;\n\n  var child_process = require('child_process');\n  var eachline = require('eachline');\n\n  opts = opts || {};\n  if (! _.has(opts, 'maxBuffer')) {\n    opts.maxBuffer = 1024 * 1024 * 10;\n  }\n\n  if (opts && opts.pipeOutput) {\n    var p = child_process.spawn(file, args, opts);\n\n    eachline(p.stdout, fiberHelpers.bindEnvironment(function (line) {\n      process.stdout.write(line + '\\n');\n    }));\n\n    eachline(p.stderr, fiberHelpers.bindEnvironment(function (line) {\n      process.stderr.write(line + '\\n');\n    }));\n\n    p.on('exit', function (code) {\n      future.return(code);\n    });\n\n    return {\n      success: !future.wait(),\n      stdout: \"\",\n      stderr: \"\"\n    };\n  }\n\n  child_process.execFile(file, args, opts, function (err, stdout, stderr) {\n    future.return({\n      success: ! err,\n      stdout: stdout,\n      stderr: stderr\n    });\n  });\n\n  return future.wait();\n};\n\nexports.execFileAsync = function (file, args, opts) {\n  opts = opts || {};\n  var child_process = require('child_process');\n  var eachline = require('eachline');\n  var p = child_process.spawn(file, args, opts);\n  var mapper = opts.lineMapper || _.identity;\n\n  var logOutput = fiberHelpers.bindEnvironment(function (line) {\n    if (opts.verbose) {\n      line = mapper(line);\n      if (line)\n        console.log(line);\n    }\n  });\n\n  eachline(p.stdout, logOutput);\n  eachline(p.stderr, logOutput);\n\n  return p;\n};\n\n\nexports.runGitInCheckout = function (...args) {\n  args.unshift(\n    '--git-dir=' +\n    files.convertToOSPath(files.pathJoin(files.getCurrentToolsDir(), '.git')));\n\n  return exports.execFileSync('git', args).stdout;\n};\n\nexports.Throttled = function (options) {\n  var self = this;\n\n  options = _.extend({ interval: 150 }, options || {});\n  self.interval = options.interval;\n  var now = +(new Date);\n\n  self.next = now;\n};\n\n_.extend(exports.Throttled.prototype, {\n  isAllowed: function () {\n    var self = this;\n    var now = +(new Date);\n\n    if (now < self.next) {\n      return false;\n    }\n\n    self.next = now + self.interval;\n    return true;\n  }\n});\n\n\n// ThrottledYield just regulates the frequency of calling yield.\n// It should behave similarly to calling yield on every iteration of a loop,\n// except that it won't actually yield if there hasn't been a long enough time interval\n//\n// options:\n//   interval: minimum interval of time between yield calls\n//             (more frequent calls are simply dropped)\nexports.ThrottledYield = function (options) {\n  var self = this;\n\n  self._throttle = new exports.Throttled(options);\n};\n\n_.extend(exports.ThrottledYield.prototype, {\n  yield: function () {\n    var self = this;\n    if (self._throttle.isAllowed()) {\n      var f = new Future;\n      // setImmediate allows signals and IO to be processed but doesn't\n      // otherwise add time-based delays. It is better for yielding than\n      // process.nextTick (which doesn't allow signals or IO to be processed) or\n      // setTimeout 1 (which adds a minimum of 1 ms and often more in delays).\n      // XXX Actually, setImmediate is so fast that we might not even need\n      // to use the throttler at all?\n      setImmediate(function () {\n        f.return();\n      });\n      f.wait();\n    }\n  }\n});\n\n// Use this to convert dates into our preferred human-readable format.\n//\n// Takes in either null, a raw date string (ex: 2014-12-09T18:37:48.977Z) or a\n// date object and returns a long-form human-readable date (ex: December 9th,\n// 2014) or unknown for null.\nexports.longformDate = function (date) {\n  if (! date) return \"Unknown\";\n  var moment = require('moment');\n  var pubDate = moment(date).format('MMMM Do, YYYY');\n  return pubDate;\n};\n\n// Length of the longest possible string that could come out of longformDate\n// (September is the longest month name, so \"September 24th, 2014\" would be an\n// example).\nexports.maxDateLength = \"September 24th, 2014\".length;\n\n// Returns a sha256 hash of a given string.\nexports.sha256 = function (contents) {\n  var crypto = require('crypto');\n  var hash = crypto.createHash('sha256');\n  hash.update(contents);\n  return hash.digest('base64');\n};\n\nexports.sourceMapLength = function (sm) {\n  if (! sm) return 0;\n  // sum the length of sources and the mappings, the size of\n  // metadata is ignored, but it is not a big deal\n  return sm.mappings.length\n       + (sm.sourcesContent || []).reduce((soFar, current) => {\n         return soFar + (current ? current.length : 0);\n       }, 0);\n};\n"]}