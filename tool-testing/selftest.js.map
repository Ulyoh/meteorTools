{"version":3,"sources":["/tools/tool-testing/selftest.js"],"names":[],"mappings":"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","file":"tools/tool-testing/selftest.js.map","sourcesContent":["var _ = require('underscore');\nvar util = require('util');\nvar Future = require('fibers/future');\nvar child_process = require('child_process');\nvar phantomjs = require('phantomjs');\nvar webdriver = require('browserstack-webdriver');\n\nvar files = require('../fs/files.js');\nvar utils = require('../utils/utils.js');\nvar parseStack = require('../utils/parse-stack.js');\nvar Console = require('../console/console.js').Console;\nvar archinfo = require('../utils/archinfo.js');\nvar config = require('../meteor-services/config.js');\nvar buildmessage = require('../utils/buildmessage.js');\n\nvar catalog = require('../packaging/catalog/catalog.js');\nvar catalogRemote = require('../packaging/catalog/catalog-remote.js');\nvar isopackCacheModule = require('../isobuild/isopack-cache.js');\nvar isopackets = require('../tool-env/isopackets.js');\n\nvar tropohouseModule = require('../packaging/tropohouse.js');\nvar packageMapModule = require('../packaging/package-map.js');\nvar release = require('../packaging/release.js');\n\nvar projectContextModule = require('../project-context.js');\nvar upgraders = require('../upgraders.js');\n\n// Exception representing a test failure\nvar TestFailure = function (reason, details) {\n  var self = this;\n  self.reason = reason;\n  self.details = details || {};\n  self.stack = (new Error).stack;\n};\n\n// Use this to decorate functions that throw TestFailure. Decorate the\n// first function that should not be included in the call stack shown\n// to the user.\nvar markStack = function (f) {\n  return parseStack.markTop(f);\n};\n\n// Call from a test to throw a TestFailure exception and bail out of the test\nvar fail = markStack(function (reason) {\n  throw new TestFailure(reason);\n});\n\n// Call from a test to assert that 'actual' is equal to 'expected',\n// with 'actual' being the value that the test got and 'expected'\n// being the expected value\nvar expectEqual = markStack(function (actual, expected) {\n  var Package = isopackets.load('ejson');\n  if (! Package.ejson.EJSON.equals(actual, expected)) {\n    throw new TestFailure(\"not-equal\", {\n      expected: expected,\n      actual: actual\n    });\n  }\n});\n\n// Call from a test to assert that 'actual' is truthy.\nvar expectTrue = markStack(function (actual) {\n  if (! actual) {\n    throw new TestFailure('not-true');\n  }\n});\n// Call from a test to assert that 'actual' is falsey.\nvar expectFalse = markStack(function (actual) {\n  if (actual) {\n    throw new TestFailure('not-false');\n  }\n});\n\nvar expectThrows = markStack(function (f) {\n  var threw = false;\n  try {\n    f();\n  } catch (e) {\n    threw = true;\n  }\n\n  if (! threw)\n    throw new TestFailure(\"expected-exception\");\n});\n\n// Execute a command synchronously, discarding stderr.\nvar execFileSync = function (binary, args, opts) {\n  return Future.wrap(function(cb) {\n    var cb2 = function(err, stdout, stderr) { cb(err, stdout); };\n    child_process.execFile(binary, args, opts, cb2);\n  })().wait();\n};\n\nvar doOrThrow = function (f) {\n  var ret;\n  var messages = buildmessage.capture(function () {\n    ret = f();\n  });\n  if (messages.hasMessages()) {\n    throw Error(messages.formatMessages());\n  }\n  return ret;\n};\n\n// Our current strategy for running tests that need warehouses is to build all\n// packages from the checkout into this temporary tropohouse directory, and for\n// each test that need a fake warehouse, copy the built packages into the\n// test-specific warehouse directory.  This isn't particularly fast, but it'll\n// do for now. We build the packages during the first test that needs them.\nvar builtPackageTropohouseDir = null;\nvar tropohouseLocalCatalog = null;\nvar tropohouseIsopackCache = null;\n\n// Let's build a minimal set of packages that's enough to get self-test\n// working.  (And that doesn't need us to download any Atmosphere packages.)\nvar ROOT_PACKAGES_TO_BUILD_IN_SANDBOX = [\n  // We need the tool in order to run from the fake warehouse at all.\n  \"meteor-tool\",\n\n  // We need the packages in the skeleton app in order to test 'meteor create'.\n  'meteor-base',\n  'mobile-experience',\n  'mongo',\n  'blaze-html-templates',\n  'session',\n  'jquery',\n  'tracker',\n  \"autopublish\",\n  \"insecure\",\n  \"standard-minifiers\",\n  \"es5-shim\"\n];\n\nvar setUpBuiltPackageTropohouse = function () {\n  if (builtPackageTropohouseDir)\n    return;\n  builtPackageTropohouseDir = files.mkdtemp('built-package-tropohouse');\n\n  if (config.getPackagesDirectoryName() !== 'packages')\n    throw Error(\"running self-test with METEOR_PACKAGE_SERVER_URL set?\");\n\n  var tropohouse = new tropohouseModule.Tropohouse(builtPackageTropohouseDir);\n  tropohouseLocalCatalog = newSelfTestCatalog();\n  var versions = {};\n  _.each(\n    tropohouseLocalCatalog.getAllNonTestPackageNames(),\n    function (packageName) {\n      versions[packageName] =\n        tropohouseLocalCatalog.getLatestVersion(packageName).version;\n  });\n  var packageMap = new packageMapModule.PackageMap(versions, {\n    localCatalog: tropohouseLocalCatalog\n  });\n  // Make an isopack cache that doesn't automatically save isopacks to disk and\n  // has no access to versioned packages.\n  tropohouseIsopackCache = new isopackCacheModule.IsopackCache({\n    packageMap: packageMap,\n    includeCordovaUnibuild: true\n  });\n  doOrThrow(function () {\n    buildmessage.enterJob(\"building self-test packages\", function () {\n      // Build the packages into the in-memory IsopackCache.\n      tropohouseIsopackCache.buildLocalPackages(\n        ROOT_PACKAGES_TO_BUILD_IN_SANDBOX);\n    });\n  });\n\n  // Save all the isopacks into builtPackageTropohouseDir/packages.  (Note that\n  // we are always putting them into the default 'packages' (assuming\n  // $METEOR_PACKAGE_SERVER_URL is not set in the self-test process itself) even\n  // though some tests will want them to be under\n  // 'packages-for-server/test-packages'; we'll fix this in _makeWarehouse.\n  tropohouseIsopackCache.eachBuiltIsopack(function (name, isopack) {\n    tropohouse._saveIsopack(isopack, name);\n  });\n};\n\nvar newSelfTestCatalog = function () {\n  if (! files.inCheckout())\n    throw Error(\"Only can build packages from a checkout\");\n\n  var catalogLocal = require('../packaging/catalog/catalog-local.js');\n  var selfTestCatalog = new catalogLocal.LocalCatalog;\n  var messages = buildmessage.capture(\n    { title: \"scanning local core packages\" },\n    function () {\n      // When building a fake warehouse from a checkout, we use local packages,\n      // but *ONLY THOSE FROM THE CHECKOUT*: not app packages or $PACKAGE_DIRS\n      // packages.  One side effect of this: we really really expect them to all\n      // build, and we're fine with dying if they don't (there's no worries\n      // about needing to springboard).\n      selfTestCatalog.initialize({\n        localPackageSearchDirs: [files.pathJoin(\n          files.getCurrentToolsDir(), 'packages')]\n      });\n    });\n  if (messages.hasMessages()) {\n    Console.arrowError(\"Errors while scanning core packages:\");\n    Console.printMessages(messages);\n    throw new Error(\"scan failed?\");\n  }\n  return selfTestCatalog;\n};\n\n\n///////////////////////////////////////////////////////////////////////////////\n// Matcher\n///////////////////////////////////////////////////////////////////////////////\n\n// Handles the job of waiting until text is seen that matches a\n// regular expression.\n\nvar Matcher = function (run) {\n  var self = this;\n  self.buf = \"\";\n  self.ended = false;\n  self.matchPattern = null;\n  self.matchFuture = null;\n  self.matchStrict = null;\n  self.run = run; // used only to set a field on exceptions\n};\n\n_.extend(Matcher.prototype, {\n  write: function (data) {\n    var self = this;\n    self.buf += data;\n    self._tryMatch();\n  },\n\n  match: function (pattern, timeout, strict) {\n    var self = this;\n    if (self.matchFuture)\n      throw new Error(\"already have a match pending?\");\n    self.matchPattern = pattern;\n    self.matchStrict = strict;\n    var f = self.matchFuture = new Future;\n    self._tryMatch(); // could clear self.matchFuture\n\n    var timer = null;\n    if (timeout) {\n      timer = setTimeout(function () {\n        var pattern = self.matchPattern;\n        self.matchPattern = null;\n        self.matchStrict = null;\n        self.matchFuture = null;\n        f['throw'](new TestFailure('match-timeout', { run: self.run,\n                                                      pattern: pattern }));\n      }, timeout * 1000);\n    }\n\n    try {\n      return f.wait();\n    } finally {\n      if (timer)\n        clearTimeout(timer);\n    }\n  },\n\n  end: function () {\n    var self = this;\n    self.ended = true;\n    self._tryMatch();\n  },\n\n  matchEmpty: function () {\n    var self = this;\n\n    if (self.buf.length > 0) {\n      Console.info(\"Extra junk is :\", self.buf);\n      throw new TestFailure('junk-at-end', { run: self.run });\n    }\n  },\n\n  _tryMatch: function () {\n    var self = this;\n\n    var f = self.matchFuture;\n    if (! f)\n      return;\n\n    var ret = null;\n\n    if (self.matchPattern instanceof RegExp) {\n      var m = self.buf.match(self.matchPattern);\n      if (m) {\n        if (self.matchStrict && m.index !== 0) {\n          self.matchFuture = null;\n          self.matchStrict = null;\n          self.matchPattern = null;\n          Console.info(\"Extra junk is: \", self.buf.substr(0, m.index));\n          f['throw'](new TestFailure(\n            'junk-before', { run: self.run, pattern: self.matchPattern }));\n          return;\n        }\n        ret = m;\n        self.buf = self.buf.slice(m.index + m[0].length);\n      }\n    } else {\n      var i = self.buf.indexOf(self.matchPattern);\n      if (i !== -1) {\n        if (self.matchStrict && i !== 0) {\n          self.matchFuture = null;\n          self.matchStrict = null;\n          self.matchPattern = null;\n          Console.info(\"Extra junk is: \", self.buf.substr(0, i));\n          f['throw'](new TestFailure('junk-before',\n                                     { run: self.run, pattern: self.matchPattern }));\n          return;\n        }\n        ret = self.matchPattern;\n        self.buf = self.buf.slice(i + self.matchPattern.length);\n      }\n    }\n\n    if (ret !== null) {\n      self.matchFuture = null;\n      self.matchStrict = null;\n      self.matchPattern = null;\n      f['return'](ret);\n      return;\n    }\n\n    if (self.ended) {\n      var failure = new TestFailure('no-match', { run: self.run,\n                                                  pattern: self.matchPattern });\n      self.matchFuture = null;\n      self.matchStrict = null;\n      self.matchPattern = null;\n      f['throw'](failure);\n      return;\n    }\n  }\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// OutputLog\n///////////////////////////////////////////////////////////////////////////////\n\n// Maintains a line-by-line merged log of multiple output channels\n// (eg, stdout and stderr).\n\nvar OutputLog = function (run) {\n  var self = this;\n\n  // each entry is an object with keys 'channel', 'text', and if it is\n  // the last entry and there was no newline terminator, 'bare'\n  self.lines = [];\n\n  // map from a channel name to an object representing a partially\n  // read line of text on that channel. That object has keys 'text'\n  // (text read), 'offset' (cursor position, equal to text.length\n  // unless a '\\r' has been read).\n  self.buffers = {};\n\n  // a Run, exclusively for inclusion in exceptions\n  self.run = run;\n};\n\n_.extend(OutputLog.prototype, {\n  write: function (channel, text) {\n    var self = this;\n\n    if (! _.has(self.buffers, 'channel'))\n      self.buffers[channel] = { text: '', offset: 0};\n    var b = self.buffers[channel];\n\n    while (text.length) {\n      var m = text.match(/^[^\\n\\r]+/);\n      if (m) {\n        // A run of non-control characters.\n        b.text = b.text.substr(0, b.offset) +\n          m[0] + b.text.substr(b.offset + m[0].length);\n        b.offset += m[0].length;\n        text = text.substr(m[0].length);\n        continue;\n      }\n\n      if (text[0] === '\\r') {\n        b.offset = 0;\n        text = text.substr(1);\n        continue;\n      }\n\n      if (text[0] === '\\n') {\n        self.lines.push({ channel: channel, text: b.text });\n        b.text = '';\n        b.offset = 0;\n        text = text.substr(1);\n        continue;\n      }\n\n      throw new Error(\"conditions should have been exhaustive?\");\n    }\n  },\n\n  end: function () {\n    var self = this;\n\n    _.each(_.keys(self.buffers), function (channel) {\n      if (self.buffers[channel].text.length) {\n        self.lines.push({ channel: channel,\n                          text: self.buffers[channel].text,\n                          bare: true });\n        self.buffers[channel] = { text: '', offset: 0};\n      }\n    });\n  },\n\n  forbid: function (pattern, channel) {\n    var self = this;\n    _.each(self.lines, function (line) {\n      if (channel && channel !== line.channel)\n        return;\n\n      var match = (pattern instanceof RegExp) ?\n        (line.text.match(pattern)) : (line.text.indexOf(pattern) !== -1);\n      if (match)\n        throw new TestFailure('forbidden-string-present', { run: self.run });\n    });\n  },\n\n  get: function () {\n    var self = this;\n    return self.lines;\n  }\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// Sandbox\n///////////////////////////////////////////////////////////////////////////////\n\n// Represents an install of the tool. Creating this creates a private\n// sandbox with its own state, separate from the state of the current\n// meteor install or checkout, from the user's homedir, and from the\n// state of any other sandbox. It also creates an empty directory\n// which will be, by default, the cwd for runs created inside the\n// sandbox (you can change this with the cd() method).\n//\n// This will throw TestFailure if it has to build packages to set up\n// the sandbox and the build fails. So, only call it from inside\n// tests.\n//\n// options:\n// - warehouse: set to sandbox the warehouse too. If you don't do\n//   this, the tests are run in the same context (checkout or\n//   warehouse) as the actual copy of meteor you're running (the\n//   meteor in 'meteor self-test'. This may only be set when you're\n//   running 'meteor self-test' from a checkout. If it is set, it\n//   should look something like this:\n//   {\n//     version1: { tools: 'tools1', notices: (...) },\n//     version2: { tools: 'tools2', upgraders: [\"a\"],\n//     notices: (...), latest: true }\n//   }\n//   This would set up a simulated warehouse with two releases in it,\n//   one called 'version1' and having a tools version of 'tools1', and\n//   similarly with 'version2'/'tools2', with the latter being marked\n//   as the latest release, and the latter also having a single\n//   upgrader named \"a\". The releases are made by building the\n//   checkout into a release, and are identical except for their\n//   version names. If you pass 'notices' (which is optional), set it\n//   to the verbatim contents of the notices.json file for the\n//   release, as an object.\n// - fakeMongo: if set, set an environment variable that causes our\n//   'fake-mongod' stub process to be started instead of 'mongod'. The\n//   tellMongo method then becomes available on Runs for controlling\n//   the stub.\n// - clients\n//   - browserstack: true if browserstack clients should be used\n//   - port: the port that the clients should run on\n\nvar Sandbox = function (options) {\n  var self = this;\n  // default options\n  options = _.extend({ clients: {} }, options);\n\n  self.root = files.mkdtemp();\n  self.warehouse = null;\n\n  self.home = files.pathJoin(self.root, 'home');\n  files.mkdir(self.home, 0o755);\n  self.cwd = self.home;\n  self.env = {};\n  self.fakeMongo = options.fakeMongo;\n\n  // By default, tests use the package server that this meteor binary is built\n  // with. If a test is tagged 'test-package-server', it uses the test\n  // server. Tests that publish packages should have this flag; tests that\n  // assume that the release's packages can be found on the server should not.\n  // Note that this only affects subprocess meteor runs, not direct invocation\n  // of packageClient!\n  if (_.contains(runningTest.tags, 'test-package-server')) {\n    if (_.has(options, 'warehouse')) {\n      // test-package-server and warehouse are basically two different ways of\n      // sort of faking out the package system for tests.  test-package-server\n      // means \"use a specific production test server\"; warehouse means \"use\n      // some fake files we put on disk and never sync\" (see _makeEnv where the\n      // offline flag is set).  Combining them doesn't make sense: either you\n      // don't sync, in which case you don't see the stuff you published, or you\n      // do sync, and suddenly the mock catalog we built is overridden by\n      // test-package-server.\n      // XXX we should just run servers locally instead of either of these\n      //     strategies\n      throw Error(\"test-package-server and warehouse cannot be combined\");\n    }\n\n    self.set('METEOR_PACKAGE_SERVER_URL', exports.testPackageServerUrl);\n  }\n\n  if (_.has(options, 'warehouse')) {\n    if (!files.inCheckout())\n      throw Error(\"make only use a fake warehouse in a checkout\");\n    self.warehouse = files.pathJoin(self.root, 'tropohouse');\n    self._makeWarehouse(options.warehouse);\n  }\n\n  self.clients = [new PhantomClient({\n    host: 'localhost',\n    port: options.clients.port || 3000\n  })];\n\n  if (options.clients && options.clients.browserstack) {\n    var browsers = [\n      { browserName: 'firefox' },\n      { browserName: 'chrome' },\n      { browserName: 'internet explorer',\n        browserVersion: '11' },\n      { browserName: 'internet explorer',\n        browserVersion: '8',\n        timeout: 60 },\n      { browserName: 'safari' },\n      { browserName: 'android' }\n    ];\n\n    _.each(browsers, function (browser) {\n      self.clients.push(new BrowserStackClient({\n        host: 'localhost',\n        port: 3000,\n        browserName: browser.browserName,\n        browserVersion: browser.browserVersion,\n        timeout: browser.timeout\n      }));\n    });\n  }\n\n  var meteorScript = process.platform === \"win32\" ? \"meteor.bat\" : \"meteor\";\n\n  // Figure out the 'meteor' to run\n  if (self.warehouse)\n    self.execPath = files.pathJoin(self.warehouse, meteorScript);\n  else\n    self.execPath = files.pathJoin(files.getCurrentToolsDir(), meteorScript);\n};\n\n_.extend(Sandbox.prototype, {\n  // Create a new test run of the tool in this sandbox.\n  run: function (...args) {\n    var self = this;\n\n    return new Run(self.execPath, {\n      sandbox: self,\n      args: args,\n      cwd: self.cwd,\n      env: self._makeEnv(),\n      fakeMongo: self.fakeMongo\n    });\n  },\n\n  // Tests a set of clients with the argument function. Each call to f(run)\n  // instantiates a Run with a different client.\n  // Use:\n  // sandbox.testWithAllClients(function (run) {\n  //   // pre-connection checks\n  //   run.connectClient();\n  //   // post-connection checks\n  // });\n  testWithAllClients: function (f, ...args) {\n    var self = this;\n    args = _.compact(args);\n\n    console.log(\"running test with \" + self.clients.length + \" client(s).\");\n\n    _.each(self.clients, function (client) {\n      console.log(\"testing with \" + client.name + \"...\");\n      var run = new Run(self.execPath, {\n        sandbox: self,\n        args: args,\n        cwd: self.cwd,\n        env: self._makeEnv(),\n        fakeMongo: self.fakeMongo,\n        client: client\n      });\n      run.baseTimeout = client.timeout;\n      f(run);\n    });\n  },\n\n  // Copy an app from a template into the current directory in the\n  // sandbox. 'to' is the subdirectory to put the app in, and\n  // 'template' is a subdirectory of tools/tests/apps to copy.\n  //\n  // Note that the arguments are the opposite order from 'cp'. That\n  // seems more intuitive to me -- if you disagree, my apologies.\n  //\n  // For example:\n  //   s.createApp('myapp', 'empty');\n  //   s.cd('myapp');\n  createApp: function (to, template, options) {\n    var self = this;\n    options = options || {};\n    var absoluteTo = files.pathJoin(self.cwd, to);\n    files.cp_r(files.pathJoin(\n      files.convertToStandardPath(__dirname), '..', 'tests', 'apps', template),\n        absoluteTo, { ignore: [/^local$/] });\n    // If the test isn't explicitly managing a mock warehouse, ensure that apps\n    // run with our release by default.\n    if (options.release) {\n      self.write(files.pathJoin(to, '.meteor/release'), options.release);\n    } else if (!self.warehouse && release.current.isProperRelease()) {\n      self.write(files.pathJoin(to, '.meteor/release'), release.current.name);\n    }\n\n    // Make sure the apps don't run any upgraders, unless they intentionally\n    // have a partial upgraders file\n    var upgradersFile =\n      new projectContextModule.FinishedUpgraders({projectDir: absoluteTo});\n    if (_.isEmpty(upgradersFile.readUpgraders())) {\n      upgradersFile.appendUpgraders(upgraders.allUpgraders());\n    }\n\n    if (options.dontPrepareApp)\n      return;\n\n    // Prepare the app (ie, build or download packages). We give this a nice\n    // long timeout, which allows the next command to not need a bloated\n    // timeout. (meteor create does this anyway.)\n    self.cd(to, function () {\n      var run = self.run(\"--prepare-app\");\n      // XXX Can we cache the output of running this once somewhere, so that\n      // multiple calls to createApp with the same template get the same cache?\n      // This is a little tricky because isopack-buildinfo.json uses absolute\n      // paths.\n      run.waitSecs(20);\n      run.expectExit(0);\n    });\n  },\n\n  // Same as createApp, but with a package.\n  //\n  // @param packageDir  {String} The directory in which to create the package\n  // @param packageName {String} The package name to create. This string will\n  //                             replace all appearances of ~package-name~\n  //                             in any package*.js files in the template\n  // @param template    {String} The package template to use. Found as a\n  //                             subdirectory in tests/packages/\n  //\n  // For example:\n  //   s.createPackage('me_mypack', me:mypack', 'empty');\n  //   s.cd('me_mypack');\n  createPackage: function (packageDir, packageName, template) {\n    var self = this;\n    var packagePath = files.pathJoin(self.cwd, packageDir);\n    var templatePackagePath = files.pathJoin(\n      files.convertToStandardPath(__dirname), '..', 'tests', 'packages', template);\n    files.cp_r(templatePackagePath, packagePath);\n\n    _.each(files.readdir(packagePath), function (file) {\n      if (file.match(/^package.*\\.js$/)) {\n        var packageJsFile = files.pathJoin(packagePath, file);\n        files.writeFile(\n          packageJsFile,\n          files.readFile(packageJsFile, \"utf8\")\n            .replace(\"~package-name~\", packageName));\n      }\n    });\n  },\n\n  // Change the cwd to be used for subsequent runs. For example:\n  //   s.run('create', 'myapp').expectExit(0);\n  //   s.cd('myapp');\n  //   s.run('add', 'somepackage') ...\n  // If you provide a callback, it will invoke the callback and then\n  // change the cwd back to the previous value.  eg:\n  //   s.cd('app1', function () {\n  //     s.run('add', 'somepackage');\n  //   });\n  //   s.cd('app2', function () {\n  //     s.run('add', 'somepackage');\n  //   });\n  cd: function (relativePath, callback) {\n    var self = this;\n    var previous = self.cwd;\n    self.cwd = files.pathResolve(self.cwd, relativePath);\n    if (callback) {\n      callback();\n      self.cwd = previous;\n    }\n  },\n\n  // Set an environment variable for subsequent runs.\n  set: function (name, value) {\n    var self = this;\n    self.env[name] = value;\n  },\n\n  // Undo set().\n  unset: function (name) {\n    var self = this;\n    delete self.env[name];\n  },\n\n  // Write to a file in the sandbox, overwriting its current contents\n  // if any. 'filename' is a path intepreted relative to the Sandbox's\n  // cwd. 'contents' is a string (utf8 is assumed).\n  write: function (filename, contents) {\n    var self = this;\n    files.writeFile(files.pathJoin(self.cwd, filename), contents, 'utf8');\n  },\n\n  // Like writeFile, but appends rather than writes.\n  append: function (filename, contents) {\n    var self = this;\n    files.appendFile(files.pathJoin(self.cwd, filename), contents, 'utf8');\n  },\n\n  // Reads a file in the sandbox as a utf8 string. 'filename' is a\n  // path intepreted relative to the Sandbox's cwd.  Returns null if\n  // file does not exist.\n  read: function (filename) {\n    var self = this;\n    var file = files.pathJoin(self.cwd, filename);\n    if (!files.exists(file))\n      return null;\n    else\n      return files.readFile(files.pathJoin(self.cwd, filename), 'utf8');\n  },\n\n  // Copy the contents of one file to another.  In these series of tests, we often\n  // want to switch contents of package.js files. It is more legible to copy in\n  // the backup file rather than trying to write into it manually.\n  cp: function(from, to) {\n    var self = this;\n    var contents = self.read(from);\n    if (!contents) {\n      throw new Error(\"File \" + from + \" does not exist.\");\n    };\n    self.write(to, contents);\n  },\n\n  // Delete a file in the sandbox. 'filename' is as in write().\n  unlink: function (filename) {\n    var self = this;\n    files.unlink(files.pathJoin(self.cwd, filename));\n  },\n\n  // Make a directory in the sandbox. 'filename' is as in write().\n  mkdir: function (dirname) {\n    var self = this;\n    var dirPath = files.pathJoin(self.cwd, dirname);\n    if (! files.exists(dirPath)) {\n      files.mkdir(dirPath);\n    }\n  },\n\n  // Rename something in the sandbox. 'oldName' and 'newName' are as in write().\n  rename: function (oldName, newName) {\n    var self = this;\n    files.rename(files.pathJoin(self.cwd, oldName),\n                 files.pathJoin(self.cwd, newName));\n  },\n\n  // Return the current contents of .meteorsession in the sandbox.\n  readSessionFile: function () {\n    var self = this;\n    return files.readFile(files.pathJoin(self.root, '.meteorsession'), 'utf8');\n  },\n\n  // Overwrite .meteorsession in the sandbox with 'contents'. You\n  // could use this in conjunction with readSessionFile to save and\n  // restore authentication states.\n  writeSessionFile: function (contents) {\n    var self = this;\n    return files.writeFile(files.pathJoin(self.root, '.meteorsession'),\n                           contents, 'utf8');\n  },\n\n  _makeEnv: function () {\n    var self = this;\n    var env = _.clone(self.env);\n    env.METEOR_SESSION_FILE = files.convertToOSPath(\n      files.pathJoin(self.root, '.meteorsession'));\n\n    if (self.warehouse) {\n      // Tell it where the warehouse lives.\n      env.METEOR_WAREHOUSE_DIR = files.convertToOSPath(self.warehouse);\n\n      // Don't ever try to refresh the stub catalog we made.\n      env.METEOR_OFFLINE_CATALOG = \"t\";\n    }\n\n    // By default (ie, with no mock warehouse and no --release arg) we should be\n    // testing the actual release this is built in, so we pretend that it is the\n    // latest release.\n    if (!self.warehouse && release.current.isProperRelease())\n      env.METEOR_TEST_LATEST_RELEASE = release.current.name;\n    return env;\n  },\n\n  // Writes a stub warehouse (really a tropohouse) to the directory\n  // self.warehouse. This warehouse only contains a meteor-tool package and some\n  // releases containing that tool only (and no packages).\n  //\n  // packageServerUrl indicates which package server we think we are using. Use\n  // the default, if we do not pass this in; you should pass it in any case that\n  // you will be specifying $METEOR_PACKAGE_SERVER_URL in the environment of a\n  // command you are running in this sandbox.\n  _makeWarehouse: function (releases) {\n    var self = this;\n\n    // Ensure we have a tropohouse to copy stuff out of.\n    setUpBuiltPackageTropohouse();\n\n    var serverUrl = self.env.METEOR_PACKAGE_SERVER_URL;\n    var packagesDirectoryName = config.getPackagesDirectoryName(serverUrl);\n    files.cp_r(files.pathJoin(builtPackageTropohouseDir, 'packages'),\n               files.pathJoin(self.warehouse, packagesDirectoryName),\n               { preserveSymlinks: true });\n\n    var stubCatalog = {\n      syncToken: {},\n      formatVersion: \"1.0\",\n      collections: {\n        packages: [],\n        versions: [],\n        builds: [],\n        releaseTracks: [],\n        releaseVersions: []\n      }\n    };\n\n    var packageVersions = {};\n    var toolPackageVersion = null;\n\n    tropohouseIsopackCache.eachBuiltIsopack(function (packageName, isopack) {\n      var packageRec = tropohouseLocalCatalog.getPackage(packageName);\n      if (! packageRec)\n        throw Error(\"no package record for \" + packageName);\n      stubCatalog.collections.packages.push(packageRec);\n\n      var versionRec = tropohouseLocalCatalog.getLatestVersion(packageName);\n      if (! versionRec)\n        throw Error(\"no version record for \" + packageName);\n      stubCatalog.collections.versions.push(versionRec);\n\n      stubCatalog.collections.builds.push({\n        buildArchitectures: isopack.buildArchitectures(),\n        versionId: versionRec._id,\n        _id: utils.randomToken()\n      });\n\n      if (packageName === \"meteor-tool\") {\n        toolPackageVersion = versionRec.version;\n      } else {\n        packageVersions[packageName] = versionRec.version;\n      }\n    });\n\n    if (! toolPackageVersion)\n      throw Error(\"no meteor-tool?\");\n\n    stubCatalog.collections.releaseTracks.push({\n      name: catalog.DEFAULT_TRACK,\n      _id: utils.randomToken()\n    });\n\n    // Now create each requested release.\n    _.each(releases, function (configuration, releaseName) {\n      // Release info\n      stubCatalog.collections.releaseVersions.push({\n        track: catalog.DEFAULT_TRACK,\n        _id: Math.random().toString(),\n        version: releaseName,\n        orderKey: releaseName,\n        description: \"test release \" + releaseName,\n        recommended: !!configuration.recommended,\n        tool: configuration.tool || \"meteor-tool@\" + toolPackageVersion,\n        packages: packageVersions\n      });\n    });\n\n    var dataFile = config.getPackageStorage({\n      root: self.warehouse,\n      serverUrl: serverUrl\n    });\n    self.warehouseOfficialCatalog = new catalogRemote.RemoteCatalog();\n    self.warehouseOfficialCatalog.initialize({\n      packageStorage: dataFile\n    });\n    self.warehouseOfficialCatalog.insertData(stubCatalog);\n\n    // And a cherry on top\n    // XXX this is hacky\n    files.linkToMeteorScript(\n      files.pathJoin(self.warehouse, packagesDirectoryName, \"meteor-tool\", toolPackageVersion,\n        'mt-' + archinfo.host(), 'meteor'),\n      files.pathJoin(self.warehouse, 'meteor'));\n  }\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// Client\n///////////////////////////////////////////////////////////////////////////////\n\nvar Client = function (options) {\n  var self = this;\n\n  self.host = options.host;\n  self.port = options.port;\n  self.url = \"http://\" + self.host + \":\" + self.port + '/' +\n    (Math.random() * 0x100000000 + 1).toString(36);\n  self.timeout = options.timeout || 40;\n\n  if (! self.connect || ! self.stop) {\n    console.log(\"Missing methods in subclass of Client.\");\n  }\n};\n\n// PhantomClient\nvar PhantomClient = function (options) {\n  var self = this;\n  Client.apply(this, arguments);\n\n  self.name = \"phantomjs\";\n  self.process = null;\n\n  self._logError = true;\n};\n\nutil.inherits(PhantomClient, Client);\n\n_.extend(PhantomClient.prototype, {\n  connect: function () {\n    var self = this;\n\n    var phantomPath = phantomjs.path;\n\n    var scriptPath = files.pathJoin(files.getCurrentToolsDir(), \"tools\",\n      \"tool-testing\", \"phantom\", \"open-url.js\");\n    self.process = child_process.execFile(phantomPath, [\"--load-images=no\",\n      files.convertToOSPath(scriptPath), self.url],\n      {}, function (error, stdout, stderr) {\n        if (self._logError && error) {\n          console.log(\"PhantomJS exited with error \", error, \"\\nstdout:\\n\", stdout, \"\\nstderr:\\n\", stderr);\n        }\n      });\n  },\n\n  stop: function() {\n    var self = this;\n    // Suppress the expected SIGTERM exit 'failure'\n    self._logError = false;\n    self.process && self.process.kill();\n    self.process = null;\n  }\n});\n\n// BrowserStackClient\nvar browserStackKey = null;\n\nvar BrowserStackClient = function (options) {\n  var self = this;\n  Client.apply(this, arguments);\n\n  self.tunnelProcess = null;\n  self.driver = null;\n\n  self.browserName = options.browserName;\n  self.browserVersion = options.browserVersion;\n\n  self.name = \"BrowserStack - \" + self.browserName;\n  if (self.browserVersion) {\n    self.name += \" \" + self.browserVersion;\n  }\n};\n\nutil.inherits(BrowserStackClient, Client);\n\n_.extend(BrowserStackClient.prototype, {\n  connect: function () {\n    var self = this;\n\n    // memoize the key\n    if (browserStackKey === null)\n      browserStackKey = self._getBrowserStackKey();\n    if (! browserStackKey)\n      throw new Error(\"BrowserStack key not found. Ensure that you \" +\n        \"have installed your S3 credentials.\");\n\n    var capabilities = {\n      'browserName' : self.browserName,\n      'browserstack.user' : 'meteor',\n      'browserstack.local' : 'true',\n      'browserstack.key' : browserStackKey\n    };\n\n    if (self.browserVersion) {\n      capabilities.browserVersion = self.browserVersion;\n    }\n\n    self._launchBrowserStackTunnel(function (error) {\n      if (error)\n        throw error;\n\n      self.driver = new webdriver.Builder().\n        usingServer('http://hub.browserstack.com/wd/hub').\n        withCapabilities(capabilities).\n        build();\n      self.driver.get(self.url);\n    });\n  },\n\n  stop: function() {\n    var self = this;\n    self.tunnelProcess && self.tunnelProcess.kill();\n    self.tunnelProcess = null;\n\n    self.driver && self.driver.quit();\n    self.driver = null;\n  },\n\n  _getBrowserStackKey: function () {\n    var outputDir = files.pathJoin(files.mkdtemp(), \"key\");\n\n    try {\n      execFileSync(\"s3cmd\", [\"get\",\n        \"s3://meteor-browserstack-keys/browserstack-key\",\n        outputDir\n      ]);\n\n      return files.readFile(outputDir, \"utf8\").trim();\n    } catch (e) {\n      return null;\n    }\n  },\n\n  _launchBrowserStackTunnel: function (callback) {\n    var self = this;\n    var browserStackPath =\n      files.pathJoin(files.getDevBundle(), 'bin', 'BrowserStackLocal');\n    files.chmod(browserStackPath, 0o755);\n\n    var args = [\n      browserStackPath,\n      browserStackKey,\n      [self.host, self.port, 0].join(','),\n      // Disable Live Testing and Screenshots, just test with Automate.\n      '-onlyAutomate',\n      // Do not wait for the server to be ready to spawn the process.\n      '-skipCheck'\n    ];\n    self.tunnelProcess = child_process.execFile(\n      '/bin/bash',\n      ['-c', args.join(' ')]\n    );\n\n    // Called when the SSH tunnel is established.\n    self.tunnelProcess.stdout.on('data', function(data) {\n      if (data.toString().match(/You can now access your local server/))\n        callback();\n    });\n  }\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// Run\n///////////////////////////////////////////////////////////////////////////////\n\n// Represents a test run of the tool (except we also use it in\n// tests/old.js to run Node scripts). Typically created through the\n// run() method on Sandbox, but can also be created directly, say if\n// you want to do something other than invoke the 'meteor' command in\n// a nice sandbox.\n//\n// Options: args, cwd, env\n//\n// The 'execPath' argument and the 'cwd' option are assumed to be standard\n// paths.\n//\n// Arguments in the 'args' option are not assumed to be standard paths, so\n// calling any of the 'files.*' methods on them is not safe.\nvar Run = function (execPath, options) {\n  var self = this;\n\n  self.execPath = execPath;\n  self.cwd = options.cwd || files.convertToStandardPath(process.cwd());\n  // default env variables\n  self.env = _.extend({ SELFTEST: \"t\", METEOR_NO_WORDWRAP: \"t\" }, options.env);\n  self._args = [];\n  self.proc = null;\n  self.baseTimeout = 20;\n  self.extraTime = 0;\n  self.client = options.client;\n\n  self.stdoutMatcher = new Matcher(self);\n  self.stderrMatcher = new Matcher(self);\n  self.outputLog = new OutputLog(self);\n\n  self.exitStatus = undefined; // 'null' means failed rather than exited\n  self.exitFutures = [];\n\n  var opts = options.args || [];\n  self.args.apply(self, opts || []);\n\n  self.fakeMongoPort = null;\n  self.fakeMongoConnection = null;\n  if (options.fakeMongo) {\n    self.fakeMongoPort = require('../utils/utils.js').randomPort();\n    self.env.METEOR_TEST_FAKE_MONGOD_CONTROL_PORT = self.fakeMongoPort;\n  }\n\n  runningTest.onCleanup(function () {\n    self._stopWithoutWaiting();\n  });\n};\n\n_.extend(Run.prototype, {\n  // Set command-line arguments. This may be called multiple times as\n  // long as the run has not yet started (the run starts after the\n  // first call to a function that requires it, like match()).\n  //\n  // Pass as many arguments as you want. Non-object values will be\n  // cast to string, and object values will be treated as maps from\n  // option names to values.\n  args: function (...args) {\n    var self = this;\n\n    if (self.proc)\n      throw new Error(\"already started?\");\n\n    _.each(args, function (a) {\n      if (typeof a !== \"object\") {\n        self._args.push('' + a);\n      } else {\n        _.each(a, function (value, key) {\n          self._args.push(\"--\" + key);\n          self._args.push('' + value);\n        });\n      }\n    });\n\n  },\n\n  connectClient: function () {\n    var self = this;\n    if (! self.client)\n      throw new Error(\"Must create Run with a client to use connectClient().\");\n\n    self._ensureStarted();\n    self.client.connect();\n  },\n\n  _exited: function (status) {\n    var self = this;\n\n    if (self.exitStatus !== undefined)\n      throw new Error(\"already exited?\");\n\n    self.client && self.client.stop();\n\n    self.exitStatus = status;\n    var exitFutures = self.exitFutures;\n    self.exitFutures = null;\n    _.each(exitFutures, function (f) {\n      f['return']();\n    });\n\n    self.stdoutMatcher.end();\n    self.stderrMatcher.end();\n  },\n\n  _ensureStarted: function () {\n    var self = this;\n\n    if (self.proc)\n      return;\n\n    var env = _.clone(process.env);\n    _.extend(env, self.env);\n\n    self.proc = child_process.spawn(files.convertToOSPath(self.execPath),\n      self._args, {\n        cwd: files.convertToOSPath(self.cwd),\n        env: env\n      });\n\n    self.proc.on('close', function (code, signal) {\n      if (self.exitStatus === undefined)\n        self._exited({ code: code, signal: signal });\n    });\n\n    self.proc.on('exit', function (code, signal) {\n      if (self.exitStatus === undefined)\n        self._exited({ code: code, signal: signal });\n    });\n\n    self.proc.on('error', function (err) {\n      if (self.exitStatus === undefined)\n        self._exited(null);\n    });\n\n    self.proc.stdout.setEncoding('utf8');\n    self.proc.stdout.on('data', function (data) {\n      self.outputLog.write('stdout', data);\n      self.stdoutMatcher.write(data);\n    });\n\n    self.proc.stderr.setEncoding('utf8');\n    self.proc.stderr.on('data', function (data) {\n      self.outputLog.write('stderr', data);\n      self.stderrMatcher.write(data);\n    });\n  },\n\n  // Wait until we get text on stdout that matches 'pattern', which\n  // may be a regular expression or a string. Consume stdout up to\n  // that point. If this pattern does not appear after a timeout (or\n  // the program exits before emitting the pattern), fail.\n  match: markStack(function (pattern, _strict) {\n    var self = this;\n    self._ensureStarted();\n\n    var timeout = self.baseTimeout + self.extraTime;\n    timeout *= utils.timeoutScaleFactor;\n    self.extraTime = 0;\n    return self.stdoutMatcher.match(pattern, timeout, _strict);\n  }),\n\n  // As expect(), but for stderr instead of stdout.\n  matchErr: markStack(function (pattern, _strict) {\n    var self = this;\n    self._ensureStarted();\n\n    var timeout = self.baseTimeout + self.extraTime;\n    timeout *= utils.timeoutScaleFactor;\n    self.extraTime = 0;\n    return self.stderrMatcher.match(pattern, timeout, _strict);\n  }),\n\n  // Like match(), but won't skip ahead looking for a match. It must\n  // follow immediately after the last thing we matched or read.\n  read: markStack(function (pattern) {\n    return this.match(pattern, true);\n  }),\n\n  // As read(), but for stderr instead of stdout.\n  readErr: markStack(function (pattern) {\n    return this.matchErr(pattern, true);\n  }),\n\n  // Assert that 'pattern' (again, a regexp or string) has not\n  // occurred on stdout at any point so far in this run. Currently\n  // this works on complete lines, so unlike match() and read(),\n  // 'pattern' cannot span multiple lines, and furthermore if it is\n  // called before the end of the program, it may not see text on a\n  // partially read line. We could lift these restrictions easily, but\n  // there may not be any benefit since the usual way to use this is\n  // to call it after expectExit or expectEnd.\n  //\n  // Example:\n  // run = s.run(\"--help\");\n  // run.expectExit(1);  // <<-- improtant to actually run the command\n  // run.forbidErr(\"unwanted string\"); // <<-- important to run **after** the\n  //                                   // command ran the process.\n  forbid: markStack(function (pattern) {\n    this._ensureStarted();\n    this.outputLog.forbid(pattern, 'stdout');\n  }),\n\n  // As forbid(), but for stderr instead of stdout.\n  forbidErr: markStack(function (pattern) {\n    this._ensureStarted();\n    this.outputLog.forbid(pattern, 'stderr');\n  }),\n\n  // Combination of forbid() and forbidErr(). Forbids the pattern on\n  // both stdout and stderr.\n  forbidAll: markStack(function (pattern) {\n    this._ensureStarted();\n    this.outputLog.forbid(pattern);\n  }),\n\n  // Expect the program to exit without anything further being\n  // printed on either stdout or stderr.\n  expectEnd: markStack(function () {\n    var self = this;\n    self._ensureStarted();\n\n    var timeout = self.baseTimeout + self.extraTime;\n    timeout *= utils.timeoutScaleFactor;\n    self.extraTime = 0;\n    self.expectExit();\n\n    self.stdoutMatcher.matchEmpty();\n    self.stderrMatcher.matchEmpty();\n  }),\n\n  // Expect the program to exit with the given (numeric) exit\n  // status. Fail if the process exits with a different code, or if\n  // the process does not exit after a timeout. You can also omit the\n  // argument to simply wait for the program to exit.\n  expectExit: markStack(function (code) {\n    var self = this;\n    self._ensureStarted();\n\n    if (self.exitStatus === undefined) {\n      var timeout = self.baseTimeout + self.extraTime;\n      timeout *= utils.timeoutScaleFactor;\n      self.extraTime = 0;\n\n      var fut = new Future;\n      self.exitFutures.push(fut);\n      var timer = setTimeout(function () {\n        self.exitFutures = _.without(self.exitFutures, fut);\n        fut['throw'](new TestFailure('exit-timeout', { run: self }));\n      }, timeout * 1000);\n\n      try {\n        fut.wait();\n      } finally {\n        clearTimeout(timer);\n      }\n    }\n\n    if (! self.exitStatus)\n      throw new TestFailure('spawn-failure', { run: self });\n    if (code !== undefined && self.exitStatus.code !== code) {\n      throw new TestFailure('wrong-exit-code', {\n        expected: { code: code },\n        actual: self.exitStatus,\n        run: self\n      });\n    }\n  }),\n\n  // Extend the timeout for the next operation by 'secs' seconds.\n  waitSecs: function (secs) {\n    var self = this;\n    self.extraTime += secs;\n  },\n\n  // Send 'string' to the program on its stdin.\n  write: function (string) {\n    var self = this;\n    self._ensureStarted();\n    self.proc.stdin.write(string);\n  },\n\n  // Kill the program and then wait for it to actually exit.\n  stop: markStack(function () {\n    var self = this;\n    if (self.exitStatus === undefined) {\n      self._ensureStarted();\n      self.client && self.client.stop();\n      self._killProcess();\n      self.expectExit();\n    }\n  }),\n\n  // Like stop, but doesn't wait for it to exit.\n  _stopWithoutWaiting: function () {\n    var self = this;\n    if (self.exitStatus === undefined && self.proc) {\n      self.client && self.client.stop();\n      self._killProcess();\n    }\n  },\n\n  // Kills the running process and it's child processes\n  _killProcess: function () {\n    if (!this.proc)\n      throw new Error(\"Unexpected: `this.proc` undefined when calling _killProcess\");\n\n    if (process.platform === \"win32\") {\n      // looks like in Windows `self.proc.kill()` doesn't kill child\n      // processes.\n      utils.execFileSync(\"taskkill\", [\"/pid\", this.proc.pid, '/f', '/t']);\n    } else {\n      this.proc.kill();\n    }\n  },\n\n  // If the fakeMongo option was set, sent a command to the stub\n  // mongod. Available commands currently are:\n  //\n  // - { stdout: \"xyz\" } to make fake-mongod write \"xyz\" to stdout\n  // - { stderr: \"xyz\" } likewise for stderr\n  // - { exit: 123 } to make fake-mongod exit with code 123\n  //\n  // Blocks until a connection to fake-mongod can be\n  // established. Throws a TestFailure if it cannot be established.\n  tellMongo: markStack(function (command) {\n    var self = this;\n\n    if (! self.fakeMongoPort)\n      throw new Error(\"fakeMongo option on sandbox must be set\");\n\n    self._ensureStarted();\n\n    // If it's the first time we've called tellMongo on this sandbox,\n    // open a connection to fake-mongod. Wait up to 10 seconds for it\n    // to accept the connection, retrying every 100ms.\n    //\n    // XXX we never clean up this connection. Hopefully once\n    // fake-mongod has dropped its end of the connection, and we hold\n    // no reference to our end, it will get gc'd. If not, that's not\n    // great, but it probably doesn't actually create any practical\n    // problems since this is only for testing.\n    if (! self.fakeMongoConnection) {\n      var net = require('net');\n\n      var lastStartTime = 0;\n      for (var attempts = 0; ! self.fakeMongoConnection && attempts < 100;\n           attempts ++) {\n        // Throttle attempts to one every 100ms\n        utils.sleepMs((lastStartTime + 100) - (+ new Date));\n        lastStartTime = +(new Date);\n\n        // Use an anonymous function so that each iteration of the\n        // loop gets its own values of 'fut' and 'conn'.\n        (function () {\n          var fut = new Future;\n          var conn = net.connect(self.fakeMongoPort, function () {\n            if (fut)\n              fut['return'](true);\n          });\n          conn.setNoDelay();\n          conn.on('error', function () {\n            if (fut)\n              fut['return'](false);\n          });\n          setTimeout(function () {\n            if (fut)\n              fut['return'](false); // 100ms connection timeout\n          }, 100);\n\n          // This is all arranged so that if a previous attempt\n          // belatedly succeeds, somehow, we ignore it.\n          if (fut.wait())\n            self.fakeMongoConnection = conn;\n          fut = null;\n        })();\n      }\n\n      if (! self.fakeMongoConnection)\n        throw new TestFailure(\"mongo-not-running\", { run: self });\n    }\n\n    self.fakeMongoConnection.write(JSON.stringify(command) + \"\\n\");\n    // If we told it to exit, then we should close our end and connect again if\n    // asked to send more.\n    if (command.exit) {\n      self.fakeMongoConnection.end();\n      self.fakeMongoConnection = null;\n    }\n  })\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// Defining tests\n///////////////////////////////////////////////////////////////////////////////\n\nvar Test = function (options) {\n  var self = this;\n  self.name = options.name;\n  self.file = options.file;\n  self.fileHash = options.fileHash;\n  self.tags = options.tags || [];\n  self.f = options.func;\n  self.cleanupHandlers = [];\n};\n\n_.extend(Test.prototype, {\n  onCleanup: function (cleanupHandler) {\n    this.cleanupHandlers.push(cleanupHandler);\n  },\n  cleanup: function () {\n    var self = this;\n    _.each(self.cleanupHandlers, function (cleanupHandler) {\n      cleanupHandler();\n    });\n    self.cleanupHandlers = [];\n  }\n});\n\nvar allTests = null;\nvar fileBeingLoaded = null;\nvar fileBeingLoadedHash = null;\nvar runningTest = null;\nvar getAllTests = function () {\n  if (allTests)\n    return allTests;\n  allTests = [];\n\n  // Load all files in the 'tests' directory that end in .js. They\n  // are supposed to then call define() to register their tests.\n  var testdir = files.pathJoin(__dirname, '..', 'tests');\n  var filenames = files.readdir(testdir);\n  _.each(filenames, function (n) {\n    if (! n.match(/^[^.].*\\.js$/)) // ends in '.js', doesn't start with '.'\n      return;\n    try {\n      if (fileBeingLoaded)\n        throw new Error(\"called recursively?\");\n      fileBeingLoaded = files.pathBasename(n, '.js');\n\n      var fullPath = files.pathJoin(testdir, n);\n      var contents = files.readFile(fullPath, 'utf8');\n      fileBeingLoadedHash =\n        require('crypto').createHash('sha1').update(contents).digest('hex');\n\n      require(files.pathJoin(testdir, n));\n    } finally {\n      fileBeingLoaded = null;\n      fileBeingLoadedHash = null;\n    }\n  });\n\n  return allTests;\n};\n\nvar define = function (name, tagsList, f) {\n  if (typeof tagsList === \"function\") {\n    // tagsList is optional\n    f = tagsList;\n    tagsList = [];\n  }\n\n  var tags = tagsList.slice();\n  tags.sort();\n\n  allTests.push(new Test({\n    name: name,\n    tags: tags,\n    file: fileBeingLoaded,\n    fileHash: fileBeingLoadedHash,\n    func: f\n  }));\n};\n\n///////////////////////////////////////////////////////////////////////////////\n// Choosing tests\n///////////////////////////////////////////////////////////////////////////////\n\nvar tagDescriptions = {\n  checkout: 'can only run from checkouts',\n  net: 'require an internet connection',\n  slow: 'take quite a long time; use --slow to include',\n  galaxy: 'galaxy-specific test testing galaxy integration',\n  cordova: 'requires Cordova support in tool (eg not on Windows)',\n  windows: 'runs only on Windows',\n  // these are pseudo-tags, assigned to tests when you specify\n  // --changed, --file, or a pattern argument\n  unchanged: 'unchanged since last pass',\n  'non-matching': \"don't match specified pattern\",\n  'in other files': \"\"\n};\n\n// Returns a TestList object representing a filtered list of tests,\n// according to the options given (which are based closely on the\n// command-line arguments).  Used as the first step of both listTests\n// and runTests.\n//\n// Options: testRegexp, fileRegexp, onlyChanged, offline, includeSlowTests, galaxyOnly\nvar getFilteredTests = function (options) {\n  options = options || {};\n  var allTests = getAllTests();\n\n  if (allTests.length) {\n    var testState = readTestState();\n\n    // Add pseudo-tags 'non-matching', 'unchanged', 'non-galaxy' and 'in other\n    // files' (but only so that we can then skip tests with those tags)\n    allTests = allTests.map(function (test) {\n      var newTags = [];\n\n      if (options.fileRegexp && ! options.fileRegexp.test(test.file)) {\n        newTags.push('in other files');\n      } else if (options.testRegexp && ! options.testRegexp.test(test.name)) {\n        newTags.push('non-matching');\n      } else if (options.onlyChanged &&\n                 test.fileHash === testState.lastPassedHashes[test.file]) {\n        newTags.push('unchanged');\n      } else if (options.excludeRegexp &&\n                 options.excludeRegexp.test(test.name)) {\n        newTags.push('excluded');\n      }\n\n      // We make sure to not run galaxy tests unless the user explicitly asks us\n      // to. Someday, this might not be the case.\n      if ( _.indexOf(test.tags, \"galaxy\") === -1) {\n        newTags.push('non-galaxy');\n      }\n\n      if (! newTags.length) {\n        return test;\n      }\n\n      return _.extend({}, test, { tags: test.tags.concat(newTags) });\n    });\n  }\n\n  // (order of tags is significant to the \"skip counts\" that are displayed)\n  var tagsToSkip = [];\n  if (options.fileRegexp) {\n    tagsToSkip.push('in other files');\n  }\n  if (options.testRegexp) {\n    tagsToSkip.push('non-matching');\n  }\n  if (options.excludeRegexp) {\n    tagsToSkip.push('excluded');\n  }\n  if (options.onlyChanged) {\n    tagsToSkip.push('unchanged');\n  }\n  if (! files.inCheckout()) {\n    tagsToSkip.push('checkout');\n  }\n  if (options.galaxyOnly) {\n    // We consider `galaxy` to imply `slow` and `net` since almost all galaxy\n    // tests involve deploying an app to a (probably) remote server.\n    tagsToSkip.push('non-galaxy');\n  } else {\n    tagsToSkip.push('galaxy');\n    if (options.offline) {\n      tagsToSkip.push('net');\n    }\n    if (! options.includeSlowTests) {\n      tagsToSkip.push('slow');\n    }\n  }\n\n  if (process.platform === \"win32\") {\n    tagsToSkip.push(\"cordova\");\n    tagsToSkip.push(\"yet-unsolved-windows-failure\");\n  } else {\n    tagsToSkip.push(\"windows\");\n  }\n\n  return new TestList(allTests, tagsToSkip, testState);\n};\n\n// A TestList is the result of getFilteredTests.  It holds the original\n// list of all tests, the filtered list, and stats on how many tests\n// were skipped (see generateSkipReport).\n//\n// TestList also has code to save the hashes of files where all tests\n// ran and passed (for the `--changed` option).  If a testState is\n// provided, the notifyFailed and saveTestState can be used to modify\n// the testState appropriately and write it out.\nvar TestList = function (allTests, tagsToSkip, testState) {\n  tagsToSkip = (tagsToSkip || []);\n  testState = (testState || null); // optional\n\n  var self = this;\n  self.allTests = allTests;\n  self.skippedTags = tagsToSkip;\n  self.skipCounts = {};\n  self.testState = testState;\n\n  _.each(tagsToSkip, function (tag) {\n    self.skipCounts[tag] = 0;\n  });\n\n  self.fileInfo = {}; // path -> {hash, hasSkips, hasFailures}\n\n  self.filteredTests = _.filter(allTests, function (test) {\n\n    if (! self.fileInfo[test.file]) {\n      self.fileInfo[test.file] = {\n        hash: test.fileHash,\n        hasSkips: false,\n        hasFailures: false\n      };\n    }\n    var fileInfo = self.fileInfo[test.file];\n\n    // We look for tagsToSkip *in order*, and when we decide to\n    // skip a test, we don't keep looking at more tags, and we don't\n    // add the test to any further \"skip counts\".\n    return !_.any(tagsToSkip, function (tag) {\n      if (_.contains(test.tags, tag)) {\n        self.skipCounts[tag]++;\n        fileInfo.hasSkips = true;\n        return true;\n      } else {\n        return false;\n      }\n    });\n  });\n};\n\n// Mark a test's file as having failures.  This prevents\n// saveTestState from saving its hash as a potentially\n// \"unchanged\" file to be skipped in a future run.\nTestList.prototype.notifyFailed = function (test) {\n  this.fileInfo[test.file].hasFailures = true;\n};\n\n// If this TestList was constructed with a testState,\n// modify it and write it out based on which tests\n// were skipped and which tests had failures.\nTestList.prototype.saveTestState = function () {\n  var self = this;\n  var testState = self.testState;\n  if (! (testState && self.filteredTests.length)) {\n    return;\n  }\n\n  _.each(self.fileInfo, function (info, f) {\n    if (info.hasFailures) {\n      delete testState.lastPassedHashes[f];\n    } else if (! info.hasSkips) {\n      testState.lastPassedHashes[f] = info.hash;\n    }\n  });\n\n  writeTestState(testState);\n};\n\n// Return a string like \"Skipped 1 foo test\\nSkipped 5 bar tests\\n\"\nTestList.prototype.generateSkipReport = function () {\n  var self = this;\n  var result = '';\n\n  _.each(self.skippedTags, function (tag) {\n    var count = self.skipCounts[tag];\n    if (count) {\n      var noun = \"test\" + (count > 1 ? \"s\" : \"\"); // \"test\" or \"tests\"\n      // \"non-matching tests\" or \"tests in other files\"\n      var nounPhrase = (/ /.test(tag) ?\n                        (noun + \" \" + tag) : (tag + \" \" + noun));\n      // \" (foo)\" or \"\"\n      var parenthetical = (tagDescriptions[tag] ? \" (\" +\n                           tagDescriptions[tag] + \")\" : '');\n      result += (\"Skipped \" + count + \" \" + nounPhrase + parenthetical + '\\n');\n    }\n  });\n\n  return result;\n};\n\nvar getTestStateFilePath = function () {\n  return files.pathJoin(files.getHomeDir(), '.meteortest');\n};\n\nvar readTestState = function () {\n  var testStateFile = getTestStateFilePath();\n  var testState;\n  if (files.exists(testStateFile))\n    testState = JSON.parse(files.readFile(testStateFile, 'utf8'));\n  if (! testState || testState.version !== 1)\n    testState = { version: 1, lastPassedHashes: {} };\n  return testState;\n};\n\nvar writeTestState = function (testState) {\n  var testStateFile = getTestStateFilePath();\n  files.writeFile(testStateFile, JSON.stringify(testState), 'utf8');\n};\n\n// Same options as getFilteredTests.  Writes to stdout and stderr.\nvar listTests = function (options) {\n  var testList = getFilteredTests(options);\n\n  if (! testList.allTests.length) {\n    Console.error(\"No tests defined.\\n\");\n    return;\n  }\n\n  _.each(_.groupBy(testList.filteredTests, 'file'), function (tests, file) {\n    Console.rawInfo(file + ':\\n');\n    _.each(tests, function (test) {\n      Console.rawInfo('  - ' + test.name +\n                      (test.tags.length ? ' [' + test.tags.join(' ') + ']'\n                      : '') + '\\n');\n    });\n  });\n\n  Console.error();\n  Console.error(testList.filteredTests.length + \" tests listed.\");\n  Console.error(testList.generateSkipReport());\n};\n\n///////////////////////////////////////////////////////////////////////////////\n// Running tests\n///////////////////////////////////////////////////////////////////////////////\n\n// options: onlyChanged, offline, includeSlowTests, historyLines, testRegexp,\n//          fileRegexp,\n//          clients:\n//             - browserstack (need s3cmd credentials)\nvar runTests = function (options) {\n  var testList = getFilteredTests(options);\n\n  if (! testList.allTests.length) {\n    Console.error(\"No tests defined.\");\n    return 0;\n  }\n\n  var totalRun = 0;\n  var failedTests = [];\n\n  _.each(testList.filteredTests, function (test) {\n    totalRun++;\n    Console.error(test.file + \": \" + test.name + \" ... \");\n\n    var failure = null;\n    try {\n      runningTest = test;\n      var startTime = +(new Date);\n      test.f(options);\n    } catch (e) {\n      failure = e;\n    } finally {\n      runningTest = null;\n      test.cleanup();\n    }\n\n    if (failure) {\n      Console.error(\"... fail!\", Console.options({ indent: 2 }));\n      failedTests.push(test);\n      testList.notifyFailed(test);\n\n      if (failure instanceof TestFailure) {\n        var frames = parseStack.parse(failure).outsideFiber;\n        var relpath = files.pathRelative(files.getCurrentToolsDir(),\n                                         frames[0].file);\n        Console.rawError(\"  => \" + failure.reason + \" at \" +\n                         relpath + \":\" + frames[0].line + \"\\n\");\n        if (failure.reason === 'no-match' || failure.reason === 'junk-before' ||\n            failure.reason === 'match-timeout') {\n          Console.arrowError(\"Pattern: \" + failure.details.pattern, 2);\n        }\n        if (failure.reason === \"wrong-exit-code\") {\n          var s = function (status) {\n            return status.signal || ('' + status.code) || \"???\";\n          };\n\n          Console.rawError(\n            \"  => \" + \"Expected: \" + s(failure.details.expected) +\n              \"; actual: \" + s(failure.details.actual) + \"\\n\");\n        }\n        if (failure.reason === 'expected-exception') {\n        }\n        if (failure.reason === 'not-equal') {\n          Console.rawError(\n            \"  => \" + \"Expected: \" + JSON.stringify(failure.details.expected) +\n              \"; actual: \" + JSON.stringify(failure.details.actual) + \"\\n\");\n        }\n\n        if (failure.details.run) {\n          failure.details.run.outputLog.end();\n          var lines = failure.details.run.outputLog.get();\n          if (! lines.length) {\n            Console.arrowError(\"No output\", 2);\n          } else {\n            var historyLines = options.historyLines || 100;\n\n            Console.arrowError(\"Last \" + historyLines + \" lines:\", 2);\n            _.each(lines.slice(-historyLines), function (line) {\n              Console.rawError(\"  \" +\n                               (line.channel === \"stderr\" ? \"2| \" : \"1| \") +\n                               line.text +\n                               (line.bare ? \"%\" : \"\") + \"\\n\");\n            });\n          }\n        }\n\n        if (failure.details.messages) {\n          Console.arrowError(\"Errors while building:\", 2);\n          Console.rawError(failure.details.messages.formatMessages() + \"\\n\");\n        }\n      } else {\n        Console.rawError(\"  => Test threw exception: \" + failure.stack + \"\\n\");\n      }\n    } else {\n      var durationMs = +(new Date) - startTime;\n      Console.error(\n        \"... ok (\" + durationMs + \" ms)\",\n        Console.options({ indent: 2 }));\n    }\n  });\n\n  testList.saveTestState();\n\n  if (totalRun > 0)\n    Console.error();\n\n  Console.error(testList.generateSkipReport());\n\n  if (testList.filteredTests.length === 0) {\n    Console.error(\"No tests run.\");\n    return 0;\n  } else if (failedTests.length === 0) {\n    var disclaimers = '';\n    if (testList.filteredTests.length < testList.allTests.length)\n      disclaimers += \" other\";\n    Console.error(\"All\" + disclaimers + \" tests passed.\");\n    return 0;\n  } else {\n    var failureCount = failedTests.length;\n    Console.error(failureCount + \" failure\" +\n                  (failureCount > 1 ? \"s\" : \"\") + \":\");\n    _.each(failedTests, function (test) {\n      Console.rawError(\"  - \" + test.file + \": \" + test.name + \"\\n\");\n    });\n    return 1;\n  }\n};\n\n// To create self-tests:\n//\n// Create a new .js file in the tests directory. It will be picked\n// up automatically.\n//\n// Start your file with something like:\n//   var selftest = require('./selftest.js');\n//   var Sandbox = selftest.Sandbox;\n//\n// Define tests with:\n//   selftest.define(\"test-name\", ['tag1', 'tag2'], function () {\n//     ...\n//   });\n//\n// The tags are used to group tests. Currently used tags:\n//   - 'checkout': should only be run when we're running from a\n//     checkout as opposed to a released copy.\n//   - 'net': test requires an internet connection. Not going to work\n//     if you're on a plane; will be skipped if we appear to be\n//     offline unless run with 'self-test --force-online'.\n//   - 'slow': test is slow enough that you don't want to run it\n//     except on purpose. Won't run unless you say 'self-test --slow'.\n//\n// If you don't want to set any tags, you can omit that parameter\n// entirely.\n//\n// Inside your test function, first create a Sandbox object, then call\n// the run() method on the sandbox to set up a new run of meteor with\n// arguments of your choice, and then use functions like match(),\n// write(), and expectExit() to script that run.\n\n_.extend(exports, {\n  runTests: runTests,\n  listTests: listTests,\n  markStack: markStack,\n  define: define,\n  Sandbox: Sandbox,\n  Run: Run,\n  fail: fail,\n  expectEqual: expectEqual,\n  expectThrows: expectThrows,\n  expectTrue: expectTrue,\n  expectFalse: expectFalse,\n  execFileSync: execFileSync,\n  doOrThrow: doOrThrow,\n  testPackageServerUrl: config.getTestPackageServerUrl()\n});\n"]}